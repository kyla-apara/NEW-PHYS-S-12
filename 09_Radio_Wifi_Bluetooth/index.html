<!DOCTYPE html>
<html lang="en">

<title>PHYS S-12: Intro to Digital Fabrication </title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="../style.css" rel="stylesheet">

<body>


<xmp theme="journal" style="display:none;">



  # Week 9: Radio, Wifi, and Bluetooth

For this weeks assignment, we were tasked with controling a board from a local wireless network. We also had to program a microcontroller to obtain and respond to information from the internet. I decided to build something that I could use for my final project.
   
## Using the ESP32!

I knew I wanted to crete something that would be useful for my final project. I decided that controlling the robot through wifi would be a good addition and so I connected the two motors to it. Orginally I started off with one motor and used <a href="http://www.esp32learning.com/code/esp32-and-l9110-fan-module-example.php" target="_blank">this tutorial</a> to create the circuit and gather the code for the ESP32. This part was relativly easy as I have worked with DC Motors before and it was pretty similar to other microcontrollers where I changed the direction of them. Here was the result for the first test of the ESP32 just to make sure the connection was fine. 


![Image of the circuit schematic](./Circuit_S.png)

<video width="540" height="960" controls>
  <source src="One_Motor_One_D.mp4" type="video/mp4">


Once I tested the code, I then decided to input my previous turning pattern code from Week 4 where the motor would turn forwards and backwards (Check week 4 for the specific code!) I also added a second motor by copying and pasting the same code but setting different input pins for Motor B. However, because of this instead of the motors rotating together in sync, they operated one after the other.


<video width="540" height="960" controls>
  <source src="Chrono.mp4" type="video/mp4"> 


 To fix this mistake I simply combined the code into the same sections and it happened to work!


 <video width="540" height="960" controls>
  <source src="Sync.mp4" type="video/mp4">


After getting the two motors to work at the same time, I knw that I would want my robot to be able to turn. I learned the easist way to do this was by having one wheel spin in one continuous direction while having the other one rotate the other way. I simple switched the outputs for Motor B from LOW to HIGH and vise versa for one spinning cycle and had Motor A continue spinning in the right direction. Here was the result, along with the code!


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/arduino-light.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/arduino.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script> 


<pre><code class="language-arduino">
int INAA = 2;
int INAB = 15;
int INBA = 12;
int INBB = 13;
void setup()
{
pinMode(INAA,OUTPUT);
pinMode(INAB,OUTPUT);
pinMode(INBA,OUTPUT);
pinMode(INBB,OUTPUT);
}
 
void loop()
{
  // start the motors
digitalWrite(INAA,LOW);
digitalWrite(INAB,HIGH);
digitalWrite(INBA,LOW);
digitalWrite(INBB,HIGH);
delay(5000);

// stop the motors
  digitalWrite(INAA, LOW);   
  digitalWrite(INAB, LOW);
  digitalWrite(INBA, LOW);  
  digitalWrite(INBB, LOW);
  delay(2000);     
      
// start one motor opposite direction
  digitalWrite(INAA, LOW); 
  digitalWrite(INAB, HIGH);  
  digitalWrite(INBA,HIGH);
  digitalWrite(INBB,LOW);
  delay(3000);              

 // stop the motors
  digitalWrite(INAA, LOW);   
  digitalWrite(INAB, LOW);
  digitalWrite(INBA, LOW);   
  digitalWrite(INBB, LOW);
  delay(2000);   
  
}
  </code></pre> 


<video width="540" height="960" controls>
  <source src="Different_Directions.mp4" type="video/mp4">

## Simple Wifi Server

To start off the requirements for this assignmnt and acatually get to the wifi connections part, after getting familiar with setting up the ESP32, I followed the tutorial provided by my teacher on how to use the Simple Wifi Server Library that I downloaded from the ESP32 examples. I started off by modifying the code by intergrading the motor code from above into the template provided, which was initailly about turning on a LED. 


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/arduino-light.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/arduino.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script> 


<pre><code class="language-arduino">
 If the IP address of your shield is yourAddress:
 http://yourAddress/H turns the Motor Pattern on
 http://yourAddress/L turns it off

 This example is written for a network using WPA2 encryption. For insecure
 WEP or WPA, change the Wifi.begin() call and use Wifi.setMinSecurity() accordingly.

 created for arduino 25 Nov 2012
 by Tom Igoe

ported for sparkfun esp32 
31.01.2017 by Jan Hendrik Berlin
 
 */

#include <WiFi.h>

WiFiServer server(80);

const char* ssid     = "MAKERSPACE";
const char* password = "12345678";
int INAA = 2;
int INAB = 15;
int INBA = 12;
int INBB = 13;

void setup()
{
    Serial.begin(115200);
   pinMode(INAA,OUTPUT);
   pinMode(INAB,OUTPUT);
   pinMode(INBA,OUTPUT);
   pinMode(INBB,OUTPUT);

    // We start by connecting to a WiFi network

    Serial.println();
    Serial.println();
    Serial.print("Connecting to ");
    Serial.println(ssid);

    WiFi.begin(ssid, password);

    while (WiFi.status() != WL_CONNECTED) {
        delay(500);
        Serial.print(".");
    }

    Serial.println("");
    Serial.println("WiFi connected.");
    Serial.println("IP address: ");
    Serial.println(WiFi.localIP());
    
    server.begin();

}

int value = 0;

void loop(){
 WiFiClient client = server.available();   // listen for incoming clients

  if (client) {                             // if you get a client,
    Serial.println("New Client.");           // print a message out the serial port
    String currentLine = "";                // make a String to hold incoming data from the client
    while (client.connected()) {            // loop while the client's connected
      if (client.available()) {             // if there's bytes to read from the client,
        char c = client.read();             // read a byte, then
        Serial.write(c);                    // print it out the serial monitor
        if (c == '\n') {                    // if the byte is a newline character

          // if the current line is blank, you got two newline characters in a row.
          // that's the end of the client HTTP request, so send a response:
          if (currentLine.length() == 0) {
            // HTTP headers always start with a response code (e.g. HTTP/1.1 200 OK)
            // and a content-type so the client knows what's coming, then a blank line:
            client.println("HTTP/1.1 200 OK");
            client.println("Content-type:text/html");
            client.println();

            // the content of the HTTP response follows the header:
            client.print("Click <a href=\"/H\">here</a> to turn the Motors on.<br>");
            client.print("Click <a href=\"/L\">here</a> to turn the Motors off.<br>");

            // The HTTP response ends with another blank line:
            client.println();
            // break out of the while loop:
            break;
          } else {    // if you got a newline, then clear currentLine:
            currentLine = "";
          }
        } else if (c != '\r') {  // if you got anything else but a carriage return character,
          currentLine += c;      // add it to the end of the currentLine
        }

        // Check to see if the client request was "GET /H" or "GET /L":
        if (currentLine.endsWith("GET /H")) {
          
// start the motors
digitalWrite(INAA,LOW);
digitalWrite(INAB,HIGH);
digitalWrite(INBA,LOW);
digitalWrite(INBB,HIGH);
delay(5000);

// stop the motors
  digitalWrite(INAA, LOW);   
  digitalWrite(INAB, LOW);
  digitalWrite(INBA, LOW);  
  digitalWrite(INBB, LOW);
  delay(2000);     
      
// start one motor opposite direction
  digitalWrite(INAA, LOW); 
  digitalWrite(INAB, HIGH);  
  digitalWrite(INBA,HIGH);
  digitalWrite(INBB,LOW);
  delay(3000);              

 // stop the motors
  digitalWrite(INAA, LOW);   
  digitalWrite(INAB, LOW);
  digitalWrite(INBA, LOW);   
  digitalWrite(INBB, LOW);
  delay(2000);   
   
        }
        if (currentLine.endsWith("GET /L")) {
         // stop the motors
  digitalWrite(INAA, LOW);   
  digitalWrite(INAB, LOW);
  digitalWrite(INBA, LOW);   
  digitalWrite(INBB, LOW);
  delay(2000);   
        }
      }
    }
    // close the connection:
    client.stop();
    Serial.println("Client Disconnected.");
  }
}
  </code></pre> 


The way to control the motors is through the website created when putting the IP Address that is displayed in from serial moniter. From there, simply click the link to turn the motors on and off!


<video width="540" height="960" controls>
  <source src="Click_Here.mp4" type="video/mp4">



  Use this to go back to the homepage! [link](../index.html).



</xmp>
</body>

<script src="https://strapdownjs.com/v/0.2/strapdown.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" ></script>

</html>